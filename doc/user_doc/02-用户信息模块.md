# 模块二：用户信息（Profile）

---

## 4.1 获取个人信息 [P0]

**接口描述**: 获取当前登录用户的完整个人信息

**请求信息**:
```
GET /api/v1/user/profile
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "uuid": "user-uuid-001",
    "nickname": "张三",
    "telephone": "13800138000",
    "email": "user@example.com",
    "avatar": "https://cdn.chatserver.com/avatars/user-001.jpg",
    "gender": 0,
    "signature": "个性签名",
    "birthday": "1995-06-15",
    "status": 0,
    "createdAt": "2026-01-01T10:00:00Z"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

---

## 4.2 获取他人信息 [P0]

**接口描述**: 获取其他用户的公开信息

**请求信息**:
```
GET /api/v1/user/profile/{userUuid}
```

**路径参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userUuid | string | ✅ | 用户UUID |

**请求示例**:
```
GET /api/v1/user/profile/user-uuid-002
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "uuid": "user-uuid-002",
    "nickname": "李四",
    "email": "li***@example.com",
    "avatar": "https://cdn.chatserver.com/avatars/user-002.jpg",
    "gender": 1,
    "signature": "Hello World",
    "isFriend": false
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**说明**: 
- 非好友关系时，telephone 和完整 email 不返回
- isFriend 字段表示与当前用户的好友关系

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11001 | 用户不存在 |

---

## 4.3 更新基本信息 [P0]

**接口描述**: 更新个人基本信息（昵称、性别、生日、签名）

**请求信息**:
```
PUT /api/v1/user/profile
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| nickname | string | ❌ | 昵称(2-20字符) |
| gender | int | ❌ | 性别(0:男 1:女 2:未知) |
| birthday | string | ❌ | 生日(YYYY-MM-DD) |
| signature | string | ❌ | 个性签名(最多100字符) |

**请求示例**:
```json
{
  "nickname": "新昵称",
  "gender": 0,
  "birthday": "1995-06-15",
  "signature": "新的个性签名"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "更新成功",
  "data": {
    "uuid": "user-uuid-001",
    "nickname": "新昵称",
    "gender": 0,
    "birthday": "1995-06-15",
    "signature": "新的个性签名"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 10001 | 参数验证失败 |
| 11010 | 昵称已被使用 |

---

## 4.4 更新头像 [P0]

**接口描述**: 上传并更新用户头像

**请求信息**:
```
POST /api/v1/user/avatar
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: multipart/form-data
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| avatar | file | ✅ | 头像文件(jpg/png,最大2MB) |

**响应示例**:
```json
{
  "code": 0,
  "message": "头像上传成功",
  "data": {
    "avatarUrl": "https://cdn.chatserver.com/avatars/user-001-new.jpg"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 10006 | 文件过大 |
| 11011 | 文件格式不支持 |
| 11012 | 文件上传失败 |

---

## 4.5 修改密码 [P1]

**接口描述**: 通过旧密码修改新密码

**请求信息**:
```
POST /api/v1/user/change-password
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| oldPassword | string | ✅ | 旧密码(明文) |
| newPassword | string | ✅ | 新密码(明文) |

**请求示例**:
```json
{
  "oldPassword": "oldPassword123",
  "newPassword": "newPassword456"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "密码修改成功",
  "module": "user",
  "timestamp": 1736344200000
}
```

**说明**: 密码修改成功后，会踢出其他所有设备登录态

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11003 | 旧密码错误 |
| 11009 | 新密码不能与旧密码相同 |

---

## 4.6 绑定/换绑邮箱 [P1]

**接口描述**: 更换绑定邮箱（需验证码）

**请求信息**:
```
POST /api/v1/user/change-email
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| newEmail | string | ✅ | 新邮箱地址 |
| verifyCode | string | ✅ | 新邮箱验证码 |

**请求示例**:
```json
{
  "newEmail": "newemail@example.com",
  "verifyCode": "123456"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "邮箱更换成功",
  "data": {
    "email": "newemail@example.com"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11002 | 邮箱已被使用 |
| 11006 | 验证码错误 |
| 11007 | 验证码已过期 |

---

## 4.7 绑定/换绑手机 [P2]

**接口描述**: 更换绑定手机号（需验证码）

**请求信息**:
```
POST /api/v1/user/change-telephone
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| newTelephone | string | ✅ | 新手机号 |
| verifyCode | string | ✅ | 短信验证码 |

**请求示例**:
```json
{
  "newTelephone": "13900139000",
  "verifyCode": "123456"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "手机号更换成功",
  "data": {
    "telephone": "13900139000"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11002 | 手机号已被使用 |
| 11006 | 验证码错误 |
| 11008 | 手机号格式错误 |

---

## 4.8 获取用户二维码 [P1]

**接口描述**: 生成个人二维码（用于加好友）

**请求信息**:
```
GET /api/v1/user/qrcode
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "qrcode": "user://add-friend?uuid=user-uuid-001&token=temp-token-xxx",
    "qrcodeImage": "https://cdn.chatserver.com/qrcodes/user-001.png",
    "expireAt": "2026-01-20T10:00:00Z"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**说明**: 
- qrcode: 二维码内容（客户端可自行生成二维码图片）
- qrcodeImage: 服务端生成的二维码图片URL（可选）
- expireAt: 二维码过期时间（24小时）

---

## 4.9 解析二维码 [P1]

**接口描述**: 通过二维码内容获取用户信息

**请求信息**:
```
POST /api/v1/user/parse-qrcode
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| qrcode | string | ✅ | 二维码内容 |

**请求示例**:
```json
{
  "qrcode": "user://add-friend?uuid=user-uuid-002&token=temp-token-xxx"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "uuid": "user-uuid-002",
    "nickname": "李四",
    "avatar": "https://cdn.chatserver.com/avatars/user-002.jpg",
    "signature": "Hello World",
    "isFriend": false
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11013 | 二维码格式错误 |
| 11014 | 二维码已过期 |
| 11001 | 用户不存在 |

---

## 4.10 注销账号 [P2]

**接口描述**: 用户注销账号（软删除 + 数据保留30天）

**请求信息**:
```
POST /api/v1/user/delete-account
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| password | string | ✅ | 当前密码(明文,验证身份) |
| reason | string | ❌ | 注销原因 |

**请求示例**:
```json
{
  "password": "password123",
  "reason": "不再使用"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "账号已注销",
  "data": {
    "deleteAt": "2026-02-18T10:00:00Z",
    "recoverDeadline": "2026-02-18T10:00:00Z"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**说明**: 
- 账号注销后30天内可恢复
- 30天后永久删除所有数据

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11003 | 密码错误 |

---

## 4.11 批量获取用户信息 [P0]

**接口描述**: 内部服务调用，批量查询用户信息

**请求信息**:
```
POST /api/v1/user/batch-profile
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userUuids | array | ✅ | 用户UUID列表(最多100个) |

**请求示例**:
```json
{
  "userUuids": ["user-uuid-001", "user-uuid-002", "user-uuid-003"]
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "users": [
      {
        "uuid": "user-uuid-001",
        "nickname": "张三",
        "avatar": "https://cdn.chatserver.com/avatars/user-001.jpg"
      },
      {
        "uuid": "user-uuid-002",
        "nickname": "李四",
        "avatar": "https://cdn.chatserver.com/avatars/user-002.jpg"
      }
    ]
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

---

> **文档版本**: v1.0.0  
> **最后更新**: 2026-01-19  
> **维护人**: 开发团队
