# 模块一：用户认证（Auth）

---

## 3.1 用户注册 [P0]

**接口描述**: 用户通过邮箱 + 验证码 + 密码注册新账号

**请求信息**:
```
POST /api/v1/public/register
```

**请求头**:
```http
Content-Type: application/json
X-Device-ID: device-uuid
X-Client-Version: 1.0.0
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| email | string | ✅ | 邮箱地址 | `user@example.com` |
| password | string | ✅ | 密码(明文,6-20位) | `password123` |
| verifyCode | string | ✅ | 邮箱验证码(6位数字) | `123456` |
| nickname | string | ❌ | 昵称(2-20字符) | `张三` |
| telephone | string | ❌ | 手机号(11位) | `13800138000` |

**请求示例**:
```json
{
  "email": "user@example.com",
  "password": "password123",
  "verifyCode": "123456",
  "nickname": "张三",
  "telephone": "13800138000"
}
```

**响应示例(成功)**:
```json
{
  "code": 0,
  "message": "注册成功",
  "data": {
    "userUuid": "user-uuid-002",
    "email": "user@example.com",
    "telephone": "13800138000",
    "nickname": "张三"
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**响应示例(失败)**:
```json
{
  "code": 11002,
  "message": "用户已存在",
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 10001 | 参数验证失败 |
| 11002 | 用户已存在 |
| 11005 | 邮箱格式错误 |
| 11006 | 验证码错误 |
| 11007 | 验证码已过期 |
| 11008 | 手机号格式错误 |

---

## 3.2 用户登录(密码) [P0]

**接口描述**: 用户通过邮箱/手机号 + 密码登录，返回 Access Token 和 Refresh Token

**请求信息**:
```
POST /api/v1/public/login
```

**请求头**:
```http
Content-Type: application/json
X-Device-ID: device-uuid
X-Client-Version: 1.0.0
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| account | string | ✅ | 邮箱或手机号 | `user@example.com` 或 `13800138000` |
| password | string | ✅ | 密码(明文) | `password123` |
| deviceInfo | object | ✅ | 设备信息(必填) | 见下方 |

**deviceInfo 结构**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| deviceName | string | ❌ | 设备名称 |
| platform | string | ✅ | 平台(iOS/Android/Web/Windows/Mac) |
| osVersion | string | ❌ | 系统版本 |
| appVersion | string | ❌ | 应用版本 |

**请求示例**:
```json
{
  "account": "user@example.com",
  "password": "password123",
  "deviceInfo": {
    "deviceName": "我的iPhone",
    "platform": "iOS",
    "osVersion": "17.0",
    "appVersion": "1.0.0"
  }
}
```

**响应示例(成功)**:
```json
{
  "code": 0,
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 7200,
    "userInfo": {
      "uuid": "user-uuid-001",
      "nickname": "张三",
      "telephone": "13800138000",
      "email": "user@example.com",
      "avatar": "https://cdn.chatserver.com/avatars/user-001.jpg",
      "gender": 0,
      "signature": "个性签名",
      "birthday": "1995-06-15",
      "status": 0
    }
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 10001 | 参数验证失败 |
| 11001 | 用户不存在 |
| 11003 | 密码错误 |
| 11004 | 用户已被禁用 |

---

## 3.3 验证码登录 [P2]

**接口描述**: 用户通过邮箱 + 验证码直接登录（无需密码）

**请求信息**:
```
POST /api/v1/public/login-by-code
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | ✅ | 邮箱地址 |
| verifyCode | string | ✅ | 验证码(6位数字) |
| deviceInfo | object | ❌ | 设备信息 |

**请求示例**:
```json
{
  "email": "user@example.com",
  "verifyCode": "123456",
  "deviceInfo": {
    "platform": "Web"
  }
}
```

**响应示例**: 同 3.2 登录接口

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 10001 | 参数验证失败 |
| 11001 | 用户不存在 |
| 11006 | 验证码错误 |
| 11007 | 验证码已过期 |

---

## 3.4 发送验证码 [P0]

**接口描述**: 发送邮箱验证码（支持注册、登录、重置密码、换绑邮箱）

**请求信息**:
```
POST /api/v1/public/send-verify-code
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | ✅ | 邮箱地址 |
| type | int | ✅ | 类型(1:注册 2:登录 3:重置密码 4:换绑邮箱) |

**请求示例**:
```json
{
  "email": "user@example.com",
  "type": 1
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "验证码已发送",
  "data": {
    "expireSeconds": 300
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 10001 | 参数验证失败 |
| 10005 | 发送过于频繁 |
| 11005 | 邮箱格式错误 |
| 11002 | 用户已存在(type=1时) |
| 11001 | 用户不存在(type=2,3,4时) |

---

## 3.5 校验验证码 [P0]

**接口描述**: 校验验证码是否正确（不消耗验证码）

**请求信息**:
```
POST /api/v1/public/verify-code
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | ✅ | 邮箱地址 |
| verifyCode | string | ✅ | 验证码 |
| type | int | ✅ | 验证码类型 |

**请求示例**:
```json
{
  "email": "user@example.com",
  "verifyCode": "123456",
  "type": 1
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "验证码正确",
  "data": {
    "valid": true
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11006 | 验证码错误 |
| 11007 | 验证码已过期 |

---

## 3.6 刷新 Token [P0]

**接口描述**: 使用 Refresh Token 刷新 Access Token

**请求信息**:
```
POST /api/v1/public/refresh-token
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| refreshToken | string | ✅ | Refresh Token |

**请求示例**:
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "刷新成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 7200
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 20002 | Token 无效 |
| 20003 | Token 已过期 |
| 15004 | 设备会话不存在 |

---

## 3.7 用户登出 [P0]

**接口描述**: 用户退出当前设备登录态

**请求信息**:
```
POST /api/v1/user/logout
```

**请求头**:
```http
Authorization: Bearer <access_token>
X-Device-ID: device-uuid
```

**响应示例**:
```json
{
  "code": 0,
  "message": "登出成功",
  "module": "user",
  "timestamp": 1736344200000
}
```

---

## 3.8 重置密码 [P1]

**接口描述**: 通过邮箱验证码重置密码（忘记密码场景）

**请求信息**:
```
POST /api/v1/public/reset-password
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | ✅ | 邮箱地址 |
| verifyCode | string | ✅ | 验证码 |
| newPassword | string | ✅ | 新密码(明文) |

**请求示例**:
```json
{
  "email": "user@example.com",
  "verifyCode": "123456",
  "newPassword": "newPassword123"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "密码重置成功",
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 11001 | 用户不存在 |
| 11006 | 验证码错误 |
| 11007 | 验证码已过期 |
| 11009 | 新密码不能与旧密码相同 |

---

> **文档版本**: v1.0.0  
> **最后更新**: 2026-01-19  
> **维护人**: 开发团队
