# 模块四：黑名单（Blacklist）

---

## 6.1 拉黑用户 [P1]

**接口描述**: 将用户加入黑名单（单向拉黑）

**行为说明**: 
A 拉黑 B 后，会产生以下效果：

1. **关系变化**: 
   - A -> B 关系状态更新为拉黑（status=1/3，区分原先是否为好友）
   - B -> A 关系不变
   - A 的黑名单中添加 B

2. **消息拦截**: 
   - B 无法给 A 发送任何消息
   - B 发送消息时会收到错误提示"对方已将你拉黑"
   - A 不会收到 B 的任何消息推送

3. **申请限制**: 
   - B 无法向 A 发送好友申请
   - B 在搜索中可以看到 A，但无法添加

4. **可见性**: 
   - B 无法查看 A 的个人资料更新
   - 历史会话中的消息记录保留

**拉黑 vs 删除好友对比**:

| 操作 | 关系状态 | 对方是否可发消息 | 对方是否可申请好友 | 场景 |
|------|---------|----------------|------------------|------|
| 删除好友 | 单向删除 | ✅ 可以 | ✅ 可以 | 整理好友列表 |
| 拉黑 | 单向拉黑+拦截 | ❌ 不可以 | ❌ 不可以 | 彻底屏蔽骚扰 |

**请求信息**:
```
POST /api/v1/auth/blacklist
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| targetUuid | string | ✅ | 目标用户UUID |

**请求示例**:
```json
{
  "targetUuid": "user-uuid-003"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "已加入黑名单",
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 16003 | 已在黑名单中 |
| 16005 | 不能拉黑自己 |

---

## 6.2 取消拉黑 [P1]

**接口描述**: 将用户从黑名单移除

**行为说明**:
- 若原先为好友（status=1），取消拉黑后恢复为好友关系
- 若原先非好友（status=3），取消拉黑后恢复为删除状态（status=2）

**请求信息**:
```
DELETE /api/v1/auth/blacklist/{userUuid}
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**路径参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userUuid | string | ✅ | 用户UUID |

**请求示例**:
```
DELETE /api/v1/auth/blacklist/user-uuid-003
```

**响应示例**:
```json
{
  "code": 0,
  "message": "已移出黑名单",
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 16004 | 不在黑名单中 |

---

## 6.3 获取黑名单列表 [P1]

**接口描述**: 获取所有被拉黑的用户

**请求信息**:
```
GET /api/v1/auth/blacklist
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**查询参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | ❌ | 页码(默认1) |
| pageSize | int | ❌ | 每页数量(默认20) |

**请求示例**:
```
GET /api/v1/auth/blacklist?page=1&pageSize=20
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [
      {
        "uuid": "user-uuid-003",
        "nickname": "王五",
        "avatar": "https://cdn.chatserver.com/avatars/user-003.jpg",
        "blacklistedAt": 1736944800000
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 1,
      "totalPages": 1
    }
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

---

## 6.4 判断是否拉黑 [P1]

**接口描述**: 内部接口，判断用户是否在黑名单中

**请求信息**:
```
POST /api/v1/auth/blacklist/check
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userUuid | string | ✅ | 用户UUID |
| targetUuid | string | ✅ | 目标UUID |

**请求示例**:
```json
{
  "userUuid": "user-uuid-001",
  "targetUuid": "user-uuid-003"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "isBlacklist": true
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

---

> **文档版本**: v1.0.0  
> **最后更新**: 2026-01-19  
> **维护人**: 开发团队
