# User 微服务功能清单

> 本文档定义 User 微服务的完整功能列表，包含 6 大模块，共计 50+ 个接口。

## 目录

- [模块一：用户认证（Auth）](#模块一用户认证auth)
- [模块二：用户信息（Profile）](#模块二用户信息profile)
- [模块三：好友关系（Friend）](#模块三好友关系friend)
- [模块四：黑名单（Blacklist）](#模块四黑名单blacklist)
- [模块五：设备会话（Device）](#模块五设备会话device)
- [模块六：群组管理（Group）](#模块六群组管理group)
- [Service 层代码结构](#service-层代码结构)
- [优先级说明](#优先级说明)

---

## 模块一：用户认证（Auth）

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 1.1 | 用户注册 | 邮箱 + 验证码 + 密码注册 | P0 | `user_info` |
| 1.2 | 用户登录 | 邮箱/手机号 + 密码登录 | P0 | `user_info`, `device_session` |
| 1.3 | 验证码登录 | 邮箱 + 验证码直接登录（可选） | P2 | `user_info` |
| 1.4 | 发送验证码 | 发送邮箱验证码（注册/登录/重置密码/换绑） | P0 | Redis |
| 1.5 | 校验验证码 | 验证邮箱验证码是否正确 | P0 | Redis |
| 1.6 | 刷新 Token | Access Token 过期时刷新 | P0 | `device_session` |
| 1.7 | 用户登出 | 退出当前设备登录态 | P0 | `device_session`, Redis |
| 1.8 | 重置密码 | 忘记密码，通过邮箱验证码重置 | P1 | `user_info` |

---

## 模块二：用户信息（Profile）

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 2.1 | 获取个人信息 | 获取自己的完整信息 | P0 | `user_info` |
| 2.2 | 获取他人信息 | 获取其他用户的公开信息（脱敏） | P0 | `user_info` |
| 2.3 | 更新基本信息 | 修改昵称、性别、生日、签名 | P0 | `user_info` |
| 2.4 | 更新头像 | 修改用户头像 | P0 | `user_info` |
| 2.5 | 修改密码 | 旧密码 + 新密码修改 | P1 | `user_info` |
| 2.6 | 绑定/换绑邮箱 | 更换绑定邮箱（需验证码） | P1 | `user_info` |
| 2.7 | 绑定/换绑手机 | 更换绑定手机号（预留扩展） | P2 | `user_info` |
| 2.8 | 获取用户二维码 | 生成个人二维码（用于加好友） | P1 | `user_info` |
| 2.9 | 解析二维码 | 通过二维码内容获取用户信息 | P1 | `user_info` |
| 2.10 | 注销账号 | 删除账号（软删除 + 数据保留期） | P2 | `user_info` |
| 2.11 | 批量获取用户信息 | 内部服务调用，批量查询用户 | P0 | `user_info` |

---

## 模块三：好友关系（Friend）

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 3.1 | 搜索用户 | 通过邮箱/昵称/ID 搜索用户 | P0 | `user_info` |
| 3.2 | 发送好友申请 | 向目标用户发送好友请求 | P0 | `apply_request` |
| 3.3 | 获取好友申请列表 | 获取收到的好友申请 | P0 | `apply_request` |
| 3.4 | 获取发出的申请列表 | 获取自己发出的申请（可选） | P2 | `apply_request` |
| 3.5 | 处理好友申请 | 同意/拒绝好友请求 | P0 | `apply_request`, `user_relation` |
| 3.6 | 获取未读申请数量 | 红点提示用 | P1 | `apply_request` |
| 3.7 | 标记申请已读 | 清除红点 | P1 | `apply_request` |
| 3.8 | 获取好友列表 | 获取所有好友及信息 | P0 | `user_relation`, `user_info` |
| 3.9 | 删除好友 | 单向删除好友关系 | P0 | `user_relation` |
| 3.10 | 设置好友备注 | 给好友设置备注名 | P1 | `user_relation` |
| 3.11 | 设置好友标签 | 给好友分组/打标签 | P2 | `user_relation` |
| 3.12 | 获取标签列表 | 获取所有好友标签 | P2 | `user_relation` |
| 3.13 | 判断是否好友 | 内部接口，判断两用户关系 | P1 | `user_relation` |
| 3.14 | 获取关系状态 | 内部接口，获取详细关系（好友/拉黑/无） | P1 | `user_relation` |

---

## 模块四：黑名单（Blacklist）

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 4.1 | 拉黑用户 | 将用户加入黑名单 | P1 | `user_relation` |
| 4.2 | 取消拉黑 | 将用户移出黑名单 | P1 | `user_relation` |
| 4.3 | 获取黑名单列表 | 获取所有被拉黑的用户 | P1 | `user_relation` |
| 4.4 | 判断是否拉黑 | 内部接口，判断是否在黑名单 | P1 | `user_relation` |

---

## 模块五：设备会话（Device）

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 5.1 | 创建设备会话 | 登录成功后记录设备信息 | P0 | `device_session` |
| 5.2 | 获取设备列表 | 查看当前登录的所有设备 | P1 | `device_session` |
| 5.3 | 踢出设备 | 强制下线某个设备 | P1 | `device_session`, Redis |
| 5.4 | 更新设备状态 | 心跳/断连时更新在线状态 | P0 | `device_session`, Redis |
| 5.5 | 获取用户在线状态 | 查询用户是否在线 | P1 | Redis |
| 5.6 | 批量获取在线状态 | 批量查询多个用户在线状态 | P1 | Redis |

---

## 模块六：群组管理（Group）

### 6.1 群组基础

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 6.1.1 | 创建群组 | 创建新群聊，创建者为群主 | P0 | `group_info`, `group_member` |
| 6.1.2 | 解散群组 | 群主解散群聊 | P1 | `group_info`, `group_member` |
| 6.1.3 | 获取群组信息 | 获取群名称、公告、头像等 | P0 | `group_info` |
| 6.1.4 | 更新群组信息 | 修改群名称、公告、头像 | P1 | `group_info` |
| 6.1.5 | 获取群组列表 | 获取用户加入的所有群 | P0 | `group_member`, `group_info` |
| 6.1.6 | 搜索群组 | 通过群名称/群ID搜索 | P1 | `group_info` |
| 6.1.7 | 获取群二维码 | 生成群二维码（用于扫码入群） | P2 | `group_info` |

### 6.2 群成员管理

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 6.2.1 | 获取群成员列表 | 获取群内所有成员 | P0 | `group_member`, `user_info` |
| 6.2.2 | 邀请成员入群 | 邀请好友加入群聊 | P0 | `group_member`, `apply_request` |
| 6.2.3 | 申请加入群组 | 通过搜索/二维码申请入群 | P1 | `apply_request` |
| 6.2.4 | 处理入群申请 | 群主/管理员同意/拒绝申请 | P1 | `apply_request`, `group_member` |
| 6.2.5 | 获取入群申请列表 | 获取待处理的入群申请 | P1 | `apply_request` |
| 6.2.6 | 退出群组 | 成员主动退群 | P0 | `group_member` |
| 6.2.7 | 踢出成员 | 群主/管理员移除成员 | P1 | `group_member` |
| 6.2.8 | 设置群成员备注 | 设置自己在群内的昵称 | P2 | `group_member` |

### 6.3 群权限管理

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 6.3.1 | 转让群主 | 群主转让给其他成员 | P1 | `group_info`, `group_member` |
| 6.3.2 | 设置管理员 | 群主设置/取消管理员 | P1 | `group_member` |
| 6.3.3 | 设置加群方式 | 直接加入/需要审核 | P2 | `group_info` |
| 6.3.4 | 禁言成员 | 对指定成员禁言 | P2 | `group_member` |
| 6.3.5 | 取消禁言 | 解除成员禁言 | P2 | `group_member` |
| 6.3.6 | 全员禁言 | 开启/关闭全员禁言 | P2 | `group_info` |

### 6.4 群组内部接口

| 序号 | 功能 | 说明 | 优先级 | 数据依赖 |
|:----:|------|------|:------:|----------|
| 6.4.1 | 判断是否群成员 | 内部接口，用于消息发送校验 | P0 | `group_member` |
| 6.4.2 | 获取成员角色 | 内部接口，获取成员权限等级 | P1 | `group_member` |
| 6.4.3 | 批量获取群成员 | 内部接口，消息推送时使用 | P0 | `group_member` |

---

## Service 层代码结构

建议在 `apps/user/internal/service/` 下按模块拆分为独立文件夹，便于维护和扩展：

```
apps/user/internal/service/
├── interface.go           # 所有 Service 接口定义
├── auth/                  # 模块一：用户认证
│   ├── auth_service.go
│   └── verify_code.go     # 验证码相关逻辑
├── profile/               # 模块二：用户信息
│   ├── profile_service.go
│   └── qrcode.go          # 二维码相关逻辑
├── friend/                # 模块三：好友关系
│   ├── friend_service.go
│   └── apply_service.go   # 好友申请相关
├── blacklist/             # 模块四：黑名单
│   └── blacklist_service.go
├── device/                # 模块五：设备会话
│   └── device_service.go
└── group/                 # 模块六：群组管理
    ├── group_service.go   # 群组基础
    ├── member_service.go  # 群成员管理
    └── permission_service.go  # 群权限管理
```

### 文件夹职责说明

| 文件夹 | 职责 | 对应模块 |
|--------|------|----------|
| `auth/` | 用户认证相关：登录、注册、验证码、Token 刷新、登出 | 模块一 |
| `profile/` | 用户信息相关：个人信息增删改查、二维码、账号设置 | 模块二 |
| `friend/` | 好友关系相关：搜索、申请、列表、备注、标签 | 模块三 |
| `blacklist/` | 黑名单相关：拉黑、取消拉黑、黑名单列表 | 模块四 |
| `device/` | 设备会话相关：多端登录、在线状态、设备管理 | 模块五 |
| `group/` | 群组相关：创建群、群成员管理、群权限管理 | 模块六 |

---

## 优先级说明

| 优先级 | 含义 | 说明 |
|:------:|------|------|
| **P0** | 核心功能 | 必须实现，是系统正常运行的基础 |
| **P1** | 重要功能 | 应该实现，提升用户体验 |
| **P2** | 扩展功能 | 可选实现，未来迭代时添加 |

---

## 功能统计

| 模块 | P0 | P1 | P2 | 合计 |
|------|:--:|:--:|:--:|:----:|
| 用户认证 | 6 | 1 | 1 | **8** |
| 用户信息 | 5 | 3 | 3 | **11** |
| 好友关系 | 6 | 5 | 3 | **14** |
| 黑名单 | 0 | 4 | 0 | **4** |
| 设备会话 | 2 | 4 | 0 | **6** |
| 群组管理 | 6 | 9 | 6 | **21** |
| **合计** | **25** | **26** | **13** | **64** |

---

## 数据表依赖

| 数据表 | 说明 | 相关模块 |
|--------|------|----------|
| `user_info` | 用户基本信息 | 认证、用户信息、好友关系 |
| `user_relation` | 用户关系（好友/拉黑） | 好友关系、黑名单 |
| `apply_request` | 申请记录（好友/入群） | 好友关系、群组管理 |
| `device_session` | 设备会话 | 认证、设备会话 |
| `group_info` | 群组信息 | 群组管理 |
| `group_member` | 群成员 | 群组管理 |

---

*文档创建时间：2026-01-17*
