# ChatServer API æ¥å£è§„èŒƒæ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0.0
> **æ›´æ–°æ—¶é—´**: 2026-01-08
> **ç»´æŠ¤äºº**: å¼€å‘å›¢é˜Ÿ
> **æ•°æ®æ ¼å¼**: JSON

---

## ğŸ“‹ ç›®å½•

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. é€šç”¨è§„èŒƒ](#2-é€šç”¨è§„èŒƒ)
- [3. ç»Ÿä¸€å“åº”æ ¼å¼](#3-ç»Ÿä¸€å“åº”æ ¼å¼)
- [4. è®¤è¯æœºåˆ¶](#4-è®¤è¯æœºåˆ¶)
- [5. é”™è¯¯ç è§„èŒƒ](#5-é”™è¯¯ç è§„èŒƒ)
- [6. æ¥å£åˆ—è¡¨](#6-æ¥å£åˆ—è¡¨)
  - [6.1 å…¬å¼€æ¥å£](#61-å…¬å¼€æ¥å£)
  - [6.2 ç”¨æˆ·è®¤è¯æ¥å£](#62-ç”¨æˆ·è®¤è¯æ¥å£)
  - [6.3 ç”¨æˆ·ç®¡ç†æ¥å£](#63-ç”¨æˆ·ç®¡ç†æ¥å£-å¾…å¼€å‘)
  - [6.4 å¥½å‹å…³ç³»æ¥å£](#64-å¥½å‹å…³ç³»æ¥å£-å¾…å¼€å‘)
  - [6.5 æ¶ˆæ¯æ¥å£](#65-æ¶ˆæ¯æ¥å£-å¾…å¼€å‘)
  - [6.6 ç¾¤ç»„æ¥å£](#66-ç¾¤ç»„æ¥å£-å¾…å¼€å‘)
- [7. æ•°æ®æ¨¡å‹](#7-æ•°æ®æ¨¡å‹)
- [8. é™„å½•](#8-é™„å½•)

---

## 1. æ¦‚è¿°

### 1.1 ç³»ç»Ÿæ¶æ„

ChatServer é‡‡ç”¨å¾®æœåŠ¡æ¶æ„,ä¸»è¦åŒ…å«ä»¥ä¸‹æœåŠ¡:

- **Gateway Service**: API ç½‘å…³æœåŠ¡,æä¾› HTTP RESTful æ¥å£
- **Connect Service**: é•¿è¿æ¥æœåŠ¡,ç»´æŒå®¢æˆ·ç«¯ WebSocket è¿æ¥
- **User Service**: ç”¨æˆ·æœåŠ¡,å¤„ç†ç”¨æˆ·ç›¸å…³ä¸šåŠ¡é€»è¾‘
- **Message Service**: æ¶ˆæ¯æœåŠ¡,å¤„ç†æ¶ˆæ¯å­˜å‚¨å’Œåˆ†å‘

### 1.2 ç¯å¢ƒä¿¡æ¯

| ç¯å¢ƒ | åŸºç¡€URL | è¯´æ˜ |
|------|---------|------|
| å¼€å‘ç¯å¢ƒ | `http://localhost:8080` | æœ¬åœ°å¼€å‘æµ‹è¯• |
| æµ‹è¯•ç¯å¢ƒ | `https://test-api.chatserver.com` | æµ‹è¯•ç¯å¢ƒ |
| ç”Ÿäº§ç¯å¢ƒ | `https://api.chatserver.com` | æ­£å¼ç¯å¢ƒ |

### 1.3 æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Gin (Go)
- **è®¤è¯æ–¹å¼**: JWT (JSON Web Token)
- **æ•°æ®åº“**: MySQL 8.0+
- **ç¼“å­˜**: Redis 7.0+
- **æ¶ˆæ¯é˜Ÿåˆ—**: Kafka
- **é€šä¿¡åè®®**: HTTP/1.1, WebSocket

---

## 2. é€šç”¨è§„èŒƒ

### 2.1 è¯·æ±‚è§„èŒƒ

#### 2.1.1 URL è®¾è®¡

- ä½¿ç”¨å°å†™å­—æ¯å’Œæ•°å­—
- å¤šä¸ªå•è¯ä½¿ç”¨è¿å­—ç¬¦ `-` è¿æ¥
- ä½¿ç”¨å¤æ•°å½¢å¼è¡¨ç¤ºèµ„æº

ç¤ºä¾‹:
```
âœ… /api/v1/users
âœ… /api/v1/user-groups
âŒ /api/v1/getUsers
âŒ /api/v1/UserInfo
```

#### 2.1.2 HTTP æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | å¹‚ç­‰æ€§ |
|------|------|--------|
| GET | è·å–èµ„æº | âœ… æ˜¯ |
| POST | åˆ›å»ºèµ„æº | âŒ å¦ |
| PUT | å®Œæ•´æ›´æ–°èµ„æº | âœ… æ˜¯ |
| PATCH | éƒ¨åˆ†æ›´æ–°èµ„æº | âŒ å¦ |
| DELETE | åˆ é™¤èµ„æº | âœ… æ˜¯ |

#### 2.1.3 è¯·æ±‚å¤´

| è¯·æ±‚å¤´ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| Content-Type | âœ… | è¯·æ±‚ä½“æ ¼å¼ | `application/json` |
| Authorization | âš ï¸ | è®¤è¯ä¿¡æ¯ | `Bearer <token>` |
| X-Request-ID | âŒ | è¯·æ±‚è¿½è¸ªID | `uuid` |
| X-Device-ID | âŒ | è®¾å¤‡å”¯ä¸€æ ‡è¯† | `device-uuid` |
| X-Client-Version | âŒ | å®¢æˆ·ç«¯ç‰ˆæœ¬ | `1.0.0` |
| User-Agent | âŒ | å®¢æˆ·ç«¯æ ‡è¯† | `ChatServer-iOS/1.0.0` |

#### 2.1.4 æŸ¥è¯¢å‚æ•°

- ä½¿ç”¨é©¼å³°å‘½å
- åˆ†é¡µå‚æ•°: `page`, `pageSize`
- æ’åºå‚æ•°: `sortField`, `sortOrder` (asc/desc)

ç¤ºä¾‹:
```
GET /api/v1/messages?page=1&pageSize=20&sortField=createdAt&sortOrder=desc
```

#### 2.1.5 æ—¶é—´æ ¼å¼

- ç»Ÿä¸€ä½¿ç”¨ Unix æ¯«ç§’æ—¶é—´æˆ³
- æ—¶åŒº: UTC

ç¤ºä¾‹:
```json
{
  "createdAt": "2026-01-08T10:30:00.000Z",
  "birthday": "1995-06-15"
}
```

#### 2.1.6 çŠ¶æ€ç 
- åªè¦æ˜¯ä¸šåŠ¡ éƒ½è¿”å›200OK

### 2.2 ç‰ˆæœ¬æ§åˆ¶

é‡‡ç”¨ URL è·¯å¾„ç‰ˆæœ¬æ§åˆ¶:

```
/api/v1/...
/api/v2/...
```

### 2.3 åˆ†é¡µè§„èŒƒ

#### 2.3.1 è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| page | int | âŒ | 1 | é¡µç (ä»1å¼€å§‹) |
| pageSize | int | âŒ | 20 | æ¯é¡µæ•°é‡(1-100) |

#### 2.3.2 å“åº”ç»“æ„

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 100,
      "totalPages": 5
    }
  }
}
```

---

## 3. ç»Ÿä¸€å“åº”æ ¼å¼

### 3.1 æˆåŠŸå“åº”

```json
{
  "code": 0,
  "message": "success",
  "data": {
    // ä¸šåŠ¡æ•°æ®
  },
  "timestamp": 1736344200000
}
```

### 3.2 é”™è¯¯å“åº”

```json
{
  "code": 40001,
  "message": "å‚æ•°éªŒè¯å¤±è´¥",
  "errors": [
    {
      "field": "telephone",
      "message": "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®"
    }
  ],
  "timestamp": 1736344200000,
  "requestId": "550e8400-e29b-41d4-a716-446655440000"
}
```

### 3.3 å“åº”å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| code | int | âœ… | ä¸šåŠ¡çŠ¶æ€ç (0è¡¨ç¤ºæˆåŠŸ) |
| message | string | âœ… | å“åº”æ¶ˆæ¯ |
| data | object/array | âŒ | å“åº”æ•°æ® |
| errors | array | âŒ | è¯¦ç»†é”™è¯¯ä¿¡æ¯(ä»…é”™è¯¯æ—¶) |
| timestamp | long | âœ… | Unixæ—¶é—´æˆ³(æ¯«ç§’) |
| requestId | string | âŒ | è¯·æ±‚è¿½è¸ªID(ä»…é”™è¯¯æ—¶) |

---

## 4. è®¤è¯æœºåˆ¶

### 4.1 JWT è®¤è¯æµç¨‹

#### 4.1.1 ç™»å½•è·å– Token

1. å®¢æˆ·ç«¯è°ƒç”¨ç™»å½•æ¥å£
2. æœåŠ¡ç«¯éªŒè¯æˆåŠŸåè¿”å› Access Token å’Œ Refresh Token
3. å®¢æˆ·ç«¯ä¿å­˜ Token

#### 4.1.2 è¯·æ±‚æºå¸¦ Token

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### 4.1.3 Token åˆ·æ–°

- Access Token è¿‡æœŸæ—¶é—´: 2 å°æ—¶
- Refresh Token è¿‡æœŸæ—¶é—´: 7 å¤©
- å½“ Access Token è¿‡æœŸæ—¶,ä½¿ç”¨ Refresh Token è·å–æ–°çš„ Access Token

### 4.2 Token ç”Ÿæˆ

#### 4.2.1 Access Token ç»“æ„

```json
{
  "user_uuid": "user-uuid-string",
  "device_id": "device-id-string",
  "exp": 1736347800,
  "iat": 1736344200,
  "iss": "ChatServer-Gateway"
}
```

#### 4.2.2 Token æœ‰æ•ˆæœŸ

| Token ç±»å‹ | æœ‰æ•ˆæœŸ | ç”¨é€” |
|-----------|--------|------|
| Access Token | 2 å°æ—¶ | è®¿é—®å—ä¿æŠ¤çš„ API æ¥å£ |
| Refresh Token | 7 å¤© | åˆ·æ–° Access Token |

### 4.3 è®¤è¯ä¸­é—´ä»¶

éœ€è¦è®¤è¯çš„æ¥å£ä¼šè‡ªåŠ¨éªŒè¯ Token,éªŒè¯å¤±è´¥è¿”å›:

```json
{
  "code": 401,
  "message": "Token æ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "timestamp": 1736344200000
}
```

---

## 5. é”™è¯¯ç è§„èŒƒ

### 5.1 é”™è¯¯ç è®¾è®¡

é”™è¯¯ç é‡‡ç”¨ 5 ä½æ•°å­—: `ç±»å‹ç (1ä½) + ä¸šåŠ¡ç (2ä½) + é”™è¯¯ç (2ä½)`

| ç±»å‹ç  | è¯´æ˜ |
|--------|------|
| 1 | å®¢æˆ·ç«¯é”™è¯¯(4xx) |
| 2 | æœåŠ¡ç«¯é”™è¯¯(5xx) |
| 9 | ç³»ç»Ÿçº§é”™è¯¯ |

### 5.2 é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|--------|-----------|------|
| 0 | 200 | æˆåŠŸ |
| 10001 | 400 | å‚æ•°éªŒè¯å¤±è´¥ |
| 10002 | 400 | è¯·æ±‚ä½“æ ¼å¼é”™è¯¯ |
| 10003 | 404 | èµ„æºä¸å­˜åœ¨ |
| 10004 | 405 | è¯·æ±‚æ–¹æ³•ä¸å…è®¸ |
| 10005 | 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 10006 | 413 | è¯·æ±‚ä½“è¿‡å¤§ |
| 20001 | 401 | æœªè®¤è¯ |
| 20002 | 401 | Token æ— æ•ˆ |
| 20003 | 401 | Token å·²è¿‡æœŸ |
| 20004 | 403 | æƒé™ä¸è¶³ |
| 30001 | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 30002 | 503 | æœåŠ¡æš‚ä¸å¯ç”¨ |

### 5.3 ä¸šåŠ¡é”™è¯¯ç 

#### ç”¨æˆ·æ¨¡å— (1xxxx)

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 11001 | ç”¨æˆ·ä¸å­˜åœ¨ |
| 11002 | ç”¨æˆ·å·²å­˜åœ¨ |
| 11003 | å¯†ç é”™è¯¯ |
| 11004 | ç”¨æˆ·å·²è¢«ç¦ç”¨ |
| 11005 | æ‰‹æœºå·æ ¼å¼é”™è¯¯ |
| 11006 | éªŒè¯ç é”™è¯¯ |
| 11007 | éªŒè¯ç å·²è¿‡æœŸ |

#### å¥½å‹æ¨¡å— (2xxxx)

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 12001 | å·²ç»æ˜¯å¥½å‹ |
| 12002 | å¥½å‹ç”³è¯·å·²å‘é€ |
| 12003 | ä¸å­˜åœ¨è¯¥å¥½å‹å…³ç³» |
| 12004 | å·²ç»æ˜¯é»‘åå• |

#### æ¶ˆæ¯æ¨¡å— (3xxxx)

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 13001 | æ¶ˆæ¯ä¸å­˜åœ¨ |
| 13002 | æ¶ˆæ¯å‘é€å¤±è´¥ |
| 13003 | æ¶ˆæ¯ç±»å‹ä¸æ”¯æŒ |
| 13004 | ä¼šè¯ä¸å­˜åœ¨ |

#### ç¾¤ç»„æ¨¡å— (4xxxx)

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 14001 | ç¾¤ç»„ä¸å­˜åœ¨ |
| 14002 | ä¸æ˜¯ç¾¤æˆå‘˜ |
| 14003 | æ²¡æœ‰æƒé™ |
| 14004 | ç¾¤æˆå‘˜å·²æ»¡ |

---

## 6. æ¥å£åˆ—è¡¨

### 6.1 å…¬å¼€æ¥å£

#### 6.1.1 å¥åº·æ£€æŸ¥

**æ¥å£æè¿°**: æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

**è¯·æ±‚ä¿¡æ¯**:
```
GET /health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "ok"
}
```

---

### 6.2 ç”¨æˆ·è®¤è¯æ¥å£

#### 6.2.1 ç”¨æˆ·ç™»å½•

**æ¥å£æè¿°**: ç”¨æˆ·é€šè¿‡æ‰‹æœºå·å’Œå¯†ç ç™»å½•,è¿”å› Access Token å’Œ Refresh Token

**è¯·æ±‚ä¿¡æ¯**:
```
POST /api/v1/public/login
```

**è¯·æ±‚å¤´**:
```http
Content-Type: application/json
X-Device-ID: device-uuid
X-Client-Version: 1.0.0
```

**è¯·æ±‚ä½“**:

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| telephone | string | âœ… | æ‰‹æœºå·(11ä½) | `13800138000` |
| password | string | âœ… | å¯†ç (åŠ å¯†å) | `encrypted_password` |
| deviceInfo | object | âŒ | è®¾å¤‡ä¿¡æ¯ | è§ä¸‹æ–¹ |

**deviceInfo ç»“æ„**:

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| platform | string | âœ… | å¹³å°(iOS/Android/Web) |
| osVersion | string | âŒ | ç³»ç»Ÿç‰ˆæœ¬ |
| appVersion | string | âŒ | åº”ç”¨ç‰ˆæœ¬ |
| deviceModel | string | âŒ | è®¾å¤‡å‹å· |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "telephone": "13800138000",
  "password": "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy",
  "deviceInfo": {
    "platform": "iOS",
    "osVersion": "17.0",
    "appVersion": "1.0.0",
    "deviceModel": "iPhone 15 Pro"
  }
}
```

**å“åº”ç¤ºä¾‹(æˆåŠŸ)**:
```json
{
  "code": 0,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 7200,
    "userInfo": {
      "uuid": "user-uuid-001",
      "nickname": "å¼ ä¸‰",
      "telephone": "13800138000",
      "email": "zhangsan@example.com",
      "avatar": "https://cdn.chatserver.com/avatars/user-001.jpg",
      "gender": 0,
      "signature": "ä¸ªæ€§ç­¾å",
      "birthday": "1995-06-15"
    }
  },
  "timestamp": 1736344200000
}
```

**å“åº”ç¤ºä¾‹(å¤±è´¥)**:
```json
{
  "code": 11003,
  "message": "å¯†ç é”™è¯¯",
  "timestamp": 1736344200000
}
```

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 10001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 11001 | ç”¨æˆ·ä¸å­˜åœ¨ |
| 11003 | å¯†ç é”™è¯¯ |
| 11004 | ç”¨æˆ·å·²è¢«ç¦ç”¨ |

#### 6.2.2 åˆ·æ–° Token

**æ¥å£æè¿°**: ä½¿ç”¨ Refresh Token åˆ·æ–° Access Token

**è¯·æ±‚ä¿¡æ¯**:
```
POST /api/v1/public/refresh-token
```

**è¯·æ±‚ä½“**:

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| refreshToken | string | âœ… | Refresh Token |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "åˆ·æ–°æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 7200
  },
  "timestamp": 1736344200000
}
```

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 10001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 20002 | Token æ— æ•ˆ |
| 20003 | Token å·²è¿‡æœŸ |

#### 6.2.3 ç”¨æˆ·æ³¨å†Œ

**æ¥å£æè¿°**: æ–°ç”¨æˆ·æ³¨å†Œè´¦å·

**è¯·æ±‚ä¿¡æ¯**:
```
POST /api/v1/public/register
```

**è¯·æ±‚å¤´**:
```http
Content-Type: application/json
X-Device-ID: device-uuid
```

**è¯·æ±‚ä½“**:

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| telephone | string | âœ… | æ‰‹æœºå·(11ä½) | `13800138000` |
| password | string | âœ… | å¯†ç (åŠ å¯†å) | `encrypted_password` |
| verifyCode | string | âœ… | éªŒè¯ç  | `123456` |
| nickname | string | âŒ | æ˜µç§° | `å¼ ä¸‰` |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "telephone": "13800138000",
  "password": "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy",
  "verifyCode": "123456",
  "nickname": "å¼ ä¸‰"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "userUuid": "user-uuid-002",
    "telephone": "13800138000",
    "nickname": "å¼ ä¸‰"
  },
  "timestamp": 1736344200000
}
```

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 10001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 11002 | ç”¨æˆ·å·²å­˜åœ¨ |
| 11005 | æ‰‹æœºå·æ ¼å¼é”™è¯¯ |
| 11006 | éªŒè¯ç é”™è¯¯ |
| 11007 | éªŒè¯ç å·²è¿‡æœŸ |

#### 6.2.4 å‘é€éªŒè¯ç 

**æ¥å£æè¿°**: å‘é€çŸ­ä¿¡éªŒè¯ç 

**è¯·æ±‚ä¿¡æ¯**:
```
POST /api/v1/public/send-sms
```

**è¯·æ±‚ä½“**:

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| telephone | string | âœ… | æ‰‹æœºå· |
| type | int | âœ… | ç±»å‹(1:æ³¨å†Œ 2:ç™»å½• 3:æ‰¾å›å¯†ç ) |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "telephone": "13800138000",
  "type": 1
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "å‘é€æˆåŠŸ",
  "timestamp": 1736344200000
}
```

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 10001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 11005 | æ‰‹æœºå·æ ¼å¼é”™è¯¯ |
| 10005 | å‘é€è¿‡äºé¢‘ç¹ |

#### 6.2.5 ç”¨æˆ·ç™»å‡º

**æ¥å£æè¿°**: ç”¨æˆ·é€€å‡ºç™»å½•

**è¯·æ±‚ä¿¡æ¯**:
```
POST /api/v1/auth/logout
```

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer <access_token>
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "ç™»å‡ºæˆåŠŸ",
  "timestamp": 1736344200000
}
```

---

### 6.3 ç”¨æˆ·ç®¡ç†æ¥å£ (å¾…å¼€å‘)

> âš ï¸ ä»¥ä¸‹æ¥å£å¾…å¼€å‘,ä»…ä½œä¸ºè®¾è®¡å‚è€ƒ

#### 6.3.1 è·å–ç”¨æˆ·ä¿¡æ¯

```
GET /api/v1/auth/user/info
```

#### 6.3.2 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

```
PUT /api/v1/auth/user/info
```

#### 6.3.3 ä¸Šä¼ å¤´åƒ

```
POST /api/v1/auth/user/avatar
```

#### 6.3.4 ä¿®æ”¹å¯†ç 

```
POST /api/v1/auth/user/password
```

---

### 6.4 å¥½å‹å…³ç³»æ¥å£ (å¾…å¼€å‘)

> âš ï¸ ä»¥ä¸‹æ¥å£å¾…å¼€å‘,ä»…ä½œä¸ºè®¾è®¡å‚è€ƒ

#### 6.4.1 æœç´¢ç”¨æˆ·

```
GET /api/v1/auth/users/search
```

#### 6.4.2 å‘é€å¥½å‹ç”³è¯·

```
POST /api/v1/auth/friends/request
```

#### 6.4.3 å¤„ç†å¥½å‹ç”³è¯·

```
PUT /api/v1/auth/friends/request/:requestId
```

#### 6.4.4 è·å–å¥½å‹åˆ—è¡¨

```
GET /api/v1/auth/friends
```

#### 6.4.5 åˆ é™¤å¥½å‹

```
DELETE /api/v1/auth/friends/:userUuid
```

---

### 6.5 æ¶ˆæ¯æ¥å£ (å¾…å¼€å‘)

> âš ï¸ ä»¥ä¸‹æ¥å£å¾…å¼€å‘,ä»…ä½œä¸ºè®¾è®¡å‚è€ƒ

#### 6.5.1 å‘é€æ¶ˆæ¯

```
POST /api/v1/auth/messages/send
```

#### 6.5.2 è·å–å†å²æ¶ˆæ¯

```
GET /api/v1/auth/messages
```

#### 6.5.3 è·å–ä¼šè¯åˆ—è¡¨

```
GET /api/v1/auth/conversations
```

---

### 6.6 ç¾¤ç»„æ¥å£ (å¾…å¼€å‘)

> âš ï¸ ä»¥ä¸‹æ¥å£å¾…å¼€å‘,ä»…ä½œä¸ºè®¾è®¡å‚è€ƒ

#### 6.6.1 åˆ›å»ºç¾¤ç»„

```
POST /api/v1/auth/groups
```

#### 6.6.2 è·å–ç¾¤ç»„ä¿¡æ¯

```
GET /api/v1/auth/groups/:groupUuid
```

#### 6.6.3 é‚€è¯·æˆå‘˜

```
POST /api/v1/auth/groups/:groupUuid/members
```

---

## 7. æ•°æ®æ¨¡å‹

### 7.1 ç”¨æˆ·ä¿¡æ¯ (UserInfo)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| uuid | string | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| nickname | string | æ˜µç§° |
| telephone | string | æ‰‹æœºå· |
| email | string | é‚®ç®± |
| avatar | string | å¤´åƒURL |
| gender | int | æ€§åˆ«(0:ç”· 1:å¥³ 2:æœªçŸ¥) |
| signature | string | ä¸ªæ€§ç­¾å |
| birthday | string | ç”Ÿæ—¥(YYYY-MM-DD) |
| status | int | çŠ¶æ€(0:æ­£å¸¸ 1:ç¦ç”¨) |

### 7.2 è®¾å¤‡ä¼šè¯ (DeviceSession)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| userUuid | string | ç”¨æˆ·UUID |
| deviceId | string | è®¾å¤‡ID |
| platform | string | å¹³å° |
| lastLoginTime | string | æœ€åç™»å½•æ—¶é—´ |
| onlineStatus | int | åœ¨çº¿çŠ¶æ€ |

### 7.3 ä¼šè¯ (Conversation)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| uuid | string | ä¼šè¯UUID |
| type | int | ç±»å‹(1:å•èŠ 2:ç¾¤èŠ) |
| name | string | ä¼šè¯åç§° |
| avatar | string | ä¼šè¯å¤´åƒ |
| lastMessage | string | æœ€åä¸€æ¡æ¶ˆæ¯ |
| lastTime | string | æœ€åæ¶ˆæ¯æ—¶é—´ |

### 7.4 æ¶ˆæ¯ (Message)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| uuid | string | æ¶ˆæ¯UUID |
| conversationUuid | string | ä¼šè¯UUID |
| senderUuid | string | å‘é€è€…UUID |
| content | string | æ¶ˆæ¯å†…å®¹ |
| msgType | int | æ¶ˆæ¯ç±»å‹(1:æ–‡æœ¬ 2:å›¾ç‰‡ 3:è¯­éŸ³...) |
| sendTime | string | å‘é€æ—¶é—´ |
| status | int | çŠ¶æ€(0:å‘é€ä¸­ 1:å·²å‘é€ 2:å·²é€è¾¾ 3:å·²è¯») |

---

## 8. é™„å½•

### 8.1 å¼€å‘ç¯å¢ƒé…ç½®

```yaml
# config.yaml
server:
  port: 8080
  mode: debug

jwt:
  secret: "your-secret-key-change-in-production"
  accessExpire: 7200    # 2å°æ—¶
  refreshExpire: 604800 # 7å¤©

redis:
  addr: "localhost:6379"
  password: ""
  db: 0

mysql:
  host: "localhost"
  port: 3306
  database: "kama_chat_server"
  username: "root"
  password: "password"
```

### 8.2 å¯†ç åŠ å¯†è§„èŒƒ

ä½¿ç”¨ bcrypt åŠ å¯†, cost factor = 10

```go
// ç¤ºä¾‹: å¯†ç åŠ å¯†
hash, _ := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)

// ç¤ºä¾‹: å¯†ç éªŒè¯
err := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))
```

### 8.3 WebSocket è¿æ¥è§„èŒƒ

#### è¿æ¥åœ°å€
```
ws://localhost:8081/ws?token=<access_token>&device_id=<device_id>
```

#### æ¶ˆæ¯æ ¼å¼
```json
{
  "type": "message",
  "data": {
    "conversationUuid": "conv-uuid",
    "content": "hello",
    "msgType": 1
  }
}

// å®¢æˆ·ç«¯æ¯ 30s å‘é€ä¸€æ¬¡
{ "type": "heartbeat" }
// æœåŠ¡ç«¯å›å¤
{ "type": "heartbeat_ack" }
```

### 8.4 æ¥å£æµ‹è¯•å·¥å…·

æ¨èä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡Œæ¥å£æµ‹è¯•:
- **Postman**: https://www.postman.com/
- **Apifox**: https://www.apifox.cn/
- **curl**: å‘½ä»¤è¡Œå·¥å…·

### 8.5 å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ç»´æŠ¤äºº |
|------|------|---------|--------|
| v1.0.0 | 2026-01-08 | åˆå§‹ç‰ˆæœ¬,åŒ…å«ç™»å½•æ¥å£ | å¼€å‘å›¢é˜Ÿ |

---


---

> **æœ€åæ›´æ–°**: 2026-01-08

