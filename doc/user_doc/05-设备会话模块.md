# 模块五：设备会话（Device）

---

## 7.1 创建设备会话 [P0]

**接口描述**: 登录成功后记录设备信息（由登录接口内部调用）

**说明**: 此接口为内部接口，由 User 服务在登录时自动调用，不对外暴露

---

## 7.2 获取设备列表 [P1]

**接口描述**: 查看当前登录的所有设备

**请求信息**:
```
GET /api/v1/user/devices
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "devices": [
      {
        "deviceId": "device-001",
        "deviceName": "我的iPhone",
        "platform": "iOS",
        "appVersion": "1.0.0",
        "lastSeenAt": "2026-01-19T10:00:00Z",
        "isCurrentDevice": true,
        "status": 0
      },
      {
        "deviceId": "device-002",
        "deviceName": "我的Mac",
        "platform": "Mac",
        "appVersion": "1.0.0",
        "lastSeenAt": "2026-01-18T15:00:00Z",
        "isCurrentDevice": false,
        "status": 0
      }
    ]
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**说明**: 
- isCurrentDevice: 是否为当前设备
- status: 0(在线) 1(离线) 2(已注销)

---

## 7.3 踢出设备 [P1]

**接口描述**: 强制下线某个设备

**请求信息**:
```
DELETE /api/v1/user/devices/{deviceId}
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**路径参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| deviceId | string | ✅ | 设备ID |

**请求示例**:
```
DELETE /api/v1/user/devices/device-002
```

**响应示例**:
```json
{
  "code": 0,
  "message": "设备已下线",
  "module": "user",
  "timestamp": 1736344200000
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 15004 | 设备不存在 |
| 15005 | 不能踢出当前设备 |

---

## 7.4 更新设备状态 [P0]

**接口描述**: 心跳/断连时更新设备在线状态（由 Connect 服务调用）

**说明**: 此接口为内部接口，由 Connect 服务调用，不对外暴露

---

## 7.5 获取用户在线状态 [P1]

**接口描述**: 查询用户是否在线

**请求信息**:
```
GET /api/v1/user/online-status/{userUuid}
```

**请求头**:
```http
Authorization: Bearer <access_token>
```

**路径参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userUuid | string | ✅ | 用户UUID |

**请求示例**:
```
GET /api/v1/user/online-status/user-uuid-002
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "userUuid": "user-uuid-002",
    "isOnline": true,
    "lastSeenAt": "2026-01-19T10:00:00Z",
    "onlinePlatforms": ["iOS", "Web"]
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

**说明**: 
- isOnline: 是否有设备在线
- onlinePlatforms: 在线设备的平台列表

---

## 7.6 批量获取在线状态 [P1]

**接口描述**: 批量查询多个用户在线状态

**请求信息**:
```
POST /api/v1/user/batch-online-status
```

**请求头**:
```http
Authorization: Bearer <access_token>
Content-Type: application/json
```

**请求体**:

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| userUuids | array | ✅ | 用户UUID列表(最多100个) |

**请求示例**:
```json
{
  "userUuids": ["user-uuid-001", "user-uuid-002", "user-uuid-003"]
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "users": [
      {
        "userUuid": "user-uuid-001",
        "isOnline": true,
        "lastSeenAt": "2026-01-19T10:00:00Z"
      },
      {
        "userUuid": "user-uuid-002",
        "isOnline": false,
        "lastSeenAt": "2026-01-18T15:00:00Z"
      }
    ]
  },
  "module": "user",
  "timestamp": 1736344200000
}
```

---

> **文档版本**: v1.0.0  
> **最后更新**: 2026-01-19  
> **维护人**: 开发团队
