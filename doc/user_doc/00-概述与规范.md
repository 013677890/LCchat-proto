# User 微服务 API 接口文档

> **版本**: v1.0.0
> **更新时间**: 2026-01-19
> **维护人**: 开发团队
> **数据格式**: JSON
> **微服务标识**: user

---

## 📋 目录

本文档已按模块拆分为以下独立文件：

- [01-用户认证模块.md](./01-用户认证模块.md) - 模块一：用户认证（Auth）
- [02-用户信息模块.md](./02-用户信息模块.md) - 模块二：用户信息（Profile）
- [03-好友关系模块.md](./03-好友关系模块.md) - 模块三：好友关系（Friend）
- [04-黑名单模块.md](./04-黑名单模块.md) - 模块四：黑名单（Blacklist）
- [05-设备会话模块.md](./05-设备会话模块.md) - 模块五：设备会话（Device）
- [06-数据模型.md](./06-数据模型.md) - 数据模型
- [07-错误码.md](./07-错误码.md) - 错误码

---

## 1. 概述

### 1.1 User 微服务职责

User 微服务负责用户相关的所有业务逻辑，包括：

- **用户认证**：注册、登录、登出、Token 管理、验证码
- **用户信息**：个人资料管理、头像、密码修改、账号设置
- **好友关系**：搜索用户、好友申请、好友列表、备注标签
- **黑名单**：拉黑、取消拉黑、黑名单列表
- **设备会话**：多端登录、设备管理、在线状态

### 1.2 技术实现

- **通信协议**: gRPC (内部服务调用)
- **API 网关**: Gateway 服务提供 HTTP RESTful 接口转发
- **数据库**: MySQL 8.0+
- **缓存**: Redis 7.0+ (验证码、在线状态、Token 黑名单)

### 1.3 接口类型

| 类型 | 路径前缀 | 说明 | 认证要求 |
|------|---------|------|---------|
| 公开接口 | `/api/v1/public/` | 注册、登录等公开接口 | ❌ 不需要 |
| 用户接口 | `/api/v1/user/` | 需要用户登录态的接口 | ✅ 需要 Bearer Token |

---

## 2. 接口规范说明

### 2.1 继承通用规范

本文档所有接口遵循 [API接口规范.md](../API接口规范.md) 中定义的通用规范，包括：

- 统一响应格式
- 请求头规范
- 分页规范
- 时间格式
- 认证机制

### 2.2 响应增强字段

为了便于识别接口归属，响应中增加 `module` 字段：

```json
{
  "code": 0,
  "message": "success",
  "data": { ... },
  "module": "user",
  "timestamp": 1736344200000
}
```

### 2.3 优先级标识

接口标题后标注优先级：
- **[P0]** - 核心功能，必须实现
- **[P1]** - 重要功能，应该实现
- **[P2]** - 扩展功能，可选实现

### 2.4 密码加密说明

**重要**: 所有涉及密码的接口，客户端传输的均为**明文密码**，服务端负责使用 bcrypt 进行加密存储。

传输安全通过 HTTPS 保证，客户端无需自行加密。

### 2.5 好友关系与拉黑说明

- **好友删除**: 采用**单向删除**模式。A 删除 B 后，A 的好友列表中 B 消失，但 B 的列表中仍有 A。B 可以正常给 A 发消息，但 A 不会在好友列表看到 B。
- **拉黑**: 采用**单向拉黑**模式。A 拉黑 B 后：
  - A 和 B 的双向好友关系自动删除
  - B 无法给 A 发送消息（会提示"对方已将你拉黑"）
  - B 无法向 A 发送好友申请
  - A 不会收到 B 的任何消息推送

---

> **文档版本**: v1.0.0  
> **最后更新**: 2026-01-19  
> **维护人**: 开发团队
